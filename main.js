function convertSQL(r,e=!1){if(!window.location.href.includes("jjlabajo"))throw"error";r=(r=(r=(r=(r=(r=(r=r.toLowerCase().trim()).replace(/;/g,"")).replace(/"/g,"'")).replace(/,/g,", ")).replace(/in\(/g,"in (")).replace(/(\r\n|\n|\r)/gm," ")).replace(/\s+/gm," "),e&&(r=r.trim().replace(/^\(/g,"").replace(/\)$/g,""));var t=getAll(/case when (.+?) end (.+?)`(.+?)`/g,r);select_raws=t.matches,r=(t=getAll(/(([a-z]|[a-z]_[a-z])+?| )\(.+?\)( | as)`.+?`/g,r=t.input,"select_subquery_function")).input,select_subqueries_functions=t.result,r=(t=getAll(/( *?\(.+?\))/g,r,"where_subquery_group")).input,where_subqueries_groups=t.result;var i=(r=r.replace(/\s+/gm," ")).split(/select | from | where | order by | limit /);return compose({select:i[1]||"",from:i[2]||"",where:i[3]||"",order_by:i[4]||"",limit:i[5]||""},select_raws,select_subqueries_functions,where_subqueries_groups,e)}function compose(r,e,t,i,n){var o,s=i,a=[],l="\n",c=r.from.split(/left join|right join|inner join|full join|cross join|join/);o=c[0].trim(),n?(a.push(`$query->from("${o}")`),l="\n\t"):a.push(`DB::table("${o}")`);var u=0;for(table_clause of c)0!=u?(a.push(join(table_clause,r.from.trim().match(/left join|right join|inner join|full join|cross join|join/g),u-1,s)),u++):u++;var p=r.select.split(",").filter(r=>!r.trim().includes("select_subquery_function")&&""!=r.trim()).map(function(r){return`"${r.trim()}"`}).join(", ");for(column of('"*"'!=p&&a.push(`->select(${changeGroups(p,s)})`),e))column=column.trim(),a.push(`->addSelect(DB::raw("${column}"))`);for(column of r.select.split(","))column=column.trim(),column.includes("select_subquery_function")&&(value=t[` ${column}`]||"",value=value.trim(),""!=value&&(/^\(.+?/g.test(value)?(alias=getAlias(value),""!=alias&&a.push(`->addSelect(['${alias}' => ${getSubquery(value)}])`)):a.push(`->addSelect(DB::raw("${value}"))`)));if(""!=r.where.trim())for(condition of(first_condition=r.where.split(/and|or/)[0].trim(),""!=first_condition&&a.push(where(first_condition,s)),get_all=getAll(/ and | or /g,r.where.replace(first_condition,"").trim()),operators=get_all.matches,conditions=r.where.trim().split(/ and | or /g).map(function(r){return r.trim()}),u=0,conditions))if(0!=u){pre="or"==(operators[u-1]||"")?"orWhere":"where";try{a.push(where(condition,s,pre))}catch(r){console.log(u,conditions)}u++}else u++;return""!=r.order_by.trim()&&a.push(`->orderBy(${r.order_by.split(" ").map(function(r){return`"${r}"`}).join(",")})`),""!=r.limit.trim()&&(limit=r.limit.trim(),/offset|,/g.test(limit)?(parts=limit.split(/offset|,/g),/offset/g.test(limit)?(void 0!==parts[1]&&a.push(`->offset(${(parts[1]||"").trim()})`),a.push(`->limit(${parts[0].trim()})`)):(a.push(`->offset(${parts[0].trim()})`),void 0!==parts[1]&&a.push(`->limit(${(parts[1]||"").trim()})`))):a.push(`->limit(${limit})`)),n?a.join(l)+";":a.join(l)}function changeGroups(r,e){var t=/where_subquery_group_(\d+)/g;if(t.test(r)){if(matches=r.match(t),Array.isArray(matches))for(match of matches)r=r.replace(match,e[` ${match}`].trim()).trim();return`DB::raw(${r})`}return r}function join(r,e,t,i){if(Array.isArray(e)||(e=[]),void 0!==(e=e.map(function(r){return r.trim()}))[t]){var n=e[t].replace(/^(.)|\s+(.)/g,function(r){return r.toUpperCase()});n=lowerCaseFirstLetter(n=n.replace(/ /g,""));var o=r.split(/on/g)[0].trim();if("crossJoin"==n){if(regex=/where_subquery_group_(\d+)/g,regex.test(r)&&(matches=r.match(regex),Array.isArray(matches)))for(match of matches)void 0!==i[` ${match}`]&&(r=r.replace(match,i[` ${match}`].trim()).trim());return`->${n}(DB::raw("${r}"))`}return`->${n}("${o}", function($join){\n\t${joinCondition(r.replace(o,"").trim(),i)}\n})`}return""}function joinCondition(r,e){var t=[],i=(r=r.replace(/on/g,"")).split(/ and | or /g)[0].trim();""!=i&&t.push(conditionOn(i,e));var n=getAll(/ and | or /g,r.replace(i,"").trim());operators=n.matches;var o=r.trim().split(/ and | or /g).map(function(r){return r.trim()});for(condition of(x=0,o))if(0!=x){pre="or"==(operators[x-1]||"")?"orOn":"on";try{t.push(conditionOn(condition,e,pre))}catch(r){console.log(x,o)}x++}else x++;return"$join"+t.join("\n\t")+";"}function conditionOn(r,e,t="on"){var i=r.split(" ");return void 0===i[1]&&void 0!==e[` ${i[0].trim()}`]?`->${t}(DB::raw(${e[` ${i[0]}`].trim()}))`:(last=`"${i[2].trim()}"`,(i[2].trim().startsWith("'")&&i[2].trim().endsWith("'")||i[2].trim().startsWith('"')&&i[2].trim().endsWith('"'))&&(last=i[2].trim()),r.includes("where_subquery_group")&&(condition=e[` ${i[2].trim()}`].trim(),/^(\(select|\( select)/g.test(condition)?last=getSubquery(condition):last="["+e[` ${i[2]}`].trim().replace(/^\(/g,"").replace(/\)$/g,"")+"]"),"in"==i[1].trim()?`->${t}In("${i[0]}", ${last})`:"is"==i[1].trim()||"between"==i[1].trim()?`->${t}(DB::raw("${r}"))`:`->${t}("${i[0]}", "${i[1]}", ${last})`)}function lowerCaseFirstLetter(r){return r.charAt(0).toLowerCase()+r.slice(1)}function where(r,e,t="where"){var i=r.split(" "),n=r,o=`"${n.split(" ")[0]||""}", "${n.split(" ")[1]||""}"`;return void 0===i[1]&&void 0!==e[` ${i[0].trim()}`]?`->${t}(DB::raw(${e[` ${i[0]}`].trim()}))`:(last=`"${i[2]}"`,r.includes("where_subquery_group")&&(condition=e[` ${i[2].trim()}`].trim(),/^(\(select|\( select)/g.test(condition)?last=getSubquery(condition):last="["+e[` ${i[2]}`].trim().replace(/^\(/g,"").replace(/\)$/g,"")+"]"),"in"==i[1].trim()?`->${t}In("${i[0]}", ${last})`:/is null/g.test(r)?`->${t}Null("${i[0]}")`:/is not null/g.test(r)?`->${t}NotNull("${i[0]}")`:`->${t}(${o}, ${last})`)}function getSubquery(r){return`function($query){\n\t${convertSQL(r=r.replace(/`(.+?)`$/g,""),!0)}\n}`}function getAlias(r){var e=(r=r.trim()).match(/`.+?`$/g);return Array.isArray(e)||(e=[]),(e[0]||"").replace(/`/g,"").trim()}function getAll(r,e,t=""){var i={},n=e.match(r);Array.isArray(n)||(n=[]);var o=1;for(match of n)replace=` ${t}_${o}_`,""==t&&(replace=""),e=e.replace(match,replace),i[replace]=match,o++;return{result:i,input:e,matches:n}}function markUp(r){var e=r.match(/"(.+?)"/g);Array.isArray(e)||(e=[]);var t={},i=1;for(string of e)key=`quoted_string_${i}_`,t[key]=string,r=r.replace(string,key),i++;for(key in r=(r=(r=(r=(r=(r=r.replace(/(>|::|:)(\D+?)(\()/g,"$1<span class='g'>$2</span>$3")).replace(/(::|->)/g,"<span class='r'>$1</span>")).replace(/(function)/g,"<i class='b'>$1</i>")).replace(/(DB)/g,"<span class='b'>$1</span>")).replace(/(\(|\)|"|,|\[|\]|;|\{|\})/g,"<span style='color:gray'>$1</span>")).replace(/(\$[a-z]+)/g,"<span style='color:white'>$1</span>"),t){string=t[key];var n=new RegExp(key,"g");r=r.replace(n,`<span style='color:#FFFCB2;'>${string}</span>`)}return r}